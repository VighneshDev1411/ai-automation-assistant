name: Trigger Workflow Scheduler (Backup)

# NOTE: This is a BACKUP scheduler. The primary cron scheduler is Vercel Cron.
# Vercel Cron is configured in vercel.json and runs every 5 minutes.
#
# This GitHub Actions workflow serves as a fallback if Vercel Cron fails,
# or can be used for manual triggering via workflow_dispatch.
#
# To use this workflow as the primary scheduler:
# 1. Set CRON_SECRET in GitHub repository secrets
# 2. Set VERCEL_PROJECT_URL in GitHub repository secrets
# 3. Enable the schedule trigger below (currently disabled)

on:
  # Uncomment to enable scheduled execution via GitHub Actions
  # schedule:
  #   - cron: '*/5 * * * *'  # Runs every 5 minutes
  workflow_dispatch: # Allow manual trigger

jobs:
  trigger-cron:
    runs-on: ubuntu-latest
    steps:
      - name: Trigger workflow scheduler
        run: |
          response=$(curl -s -w "\n%{http_code}" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}" \
            https://${{ secrets.VERCEL_PROJECT_URL }}/api/cron/execute-schedules)

          http_code=$(echo "$response" | tail -n1)
          body=$(echo "$response" | head -n-1)

          echo "HTTP Status: $http_code"
          echo "Response Body: $body"

          if [ "$http_code" != "200" ]; then
            echo "::error::Cron trigger failed with status $http_code"
            echo "::error::Response: $body"
            exit 1
          fi

          echo "âœ“ Cron trigger executed successfully"
